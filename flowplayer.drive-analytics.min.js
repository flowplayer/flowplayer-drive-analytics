/*!

   Drive analytics plugin for Flowplayer HTML5

   Copyright (c) 2016, Flowplayer Oy

   Released under the ISC License:
   https://opensource.org/licenses/ISC

*/
!function(){function e(e){var n=document.createElement("a");n.href=e;var o=["cdn.flowplayer.org","drive.flowplayer.org"],r=["cdn.dev.flowplayer.org"];return o.indexOf(n.hostname)!==-1?"https://api.flowplayer.org/events/play":r.indexOf(n.hostname)!==-1?"https://api.flowplayer.org/events/dev/play":void 0}var n=function(n){n(function(o){function r(e){e&&o.off(".drivetrack")}var t;o.on("ready",function(i,s,a){function f(n,o,r,t,i){if("number"==typeof o&&isFinite(o)){var s=e(n);if(s){var a=new XMLHttpRequest;a.open("POST",s),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&200!==a.status&&i(new Error("Request error"))},a.send(JSON.stringify({play:{src:n,seconds:o,p2pBytes:p,playerVersion:r,finished:!!t}})),p=0}}}var p=0;"undefined"!=typeof xflow&&xflow.Broker.on(xflow.Events.STATS,function(e){e.p2p&&(p+=e.loaded)}),o.one(o.conf.splash?"progress":"resume",function(){f(a.src,0,n.version,!1,r),t=5,o.on("progress.drivetrack",function(e,i,s){s<t||(f(o.video.src,t,n.version,!1,r),t+=5)}),o.on("finish.drivetrack",function(){f(o.video.src,o.video.duration,n.version,!0,r),o.one("resume",function(){f(a.src,0,n.version,!1,r),t=5})}),o.on("seek",function(e,n,o){t=5*Math.ceil(o/5)})})})})};"object"==typeof module&&module.exports?module.exports=n:"function"==typeof flowplayer&&n(flowplayer)}();